<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Korean Grammar in Use (Advanced) - Complete Video Learning Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }
        .nav-link.active {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
            font-weight: 600;
        }
        .grammar-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            margin-bottom: 2rem;
        }
        .pattern-title {
            background: linear-gradient(135deg, #1e40af, #3b82f6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        .example-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-left: 4px solid #f59e0b;
            padding: 16px;
            border-radius: 8px;
            margin: 12px 0;
        }
        .tip-box {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            border-left: 4px solid #3b82f6;
            padding: 16px;
            border-radius: 8px;
            margin: 12px 0;
        }
        .korean-text {
            font-weight: 500;
            color: #1e40af;
        }
        .english-text {
            color: #64748b;
            font-style: italic;
        }
        .chapter-badge {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .video-container {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            margin-top: 16px;
            border: 2px dashed #cbd5e1;
            display: none;
        }
        .video-container.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .video-button {
            background: #f3f4f6;
            color: #374151;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s;
            border: 1px solid #d1d5db;
            cursor: pointer;
        }
        .video-button:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }
        .close-button {
            background: #fef2f2;
            color: #b91c1c;
            padding: 4px 10px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 12px;
            border: 1px solid #fecaca;
            cursor: pointer;
        }
        .resource-report {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border-left: 4px solid #16a34a;
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
            font-size: 14px;
        }
        .resource-type {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 12px;
            margin-right: 6px;
        }
        .video-res { background-color: #fecaca; color: #b91c1c; }
        .article-res { background-color: #bbf7d0; color: #15803d; }
        .interactive-res { background-color: #bfdbfe; color: #1d4ed8; }
    </style>
</head>
<body class="text-gray-800">
    <div class="flex flex-col lg:flex-row min-h-screen">
        <!-- Sidebar Navigation -->
        <aside class="w-full lg:w-80 bg-white border-r border-gray-200 flex-shrink-0 shadow-lg">
            <div class="p-6 border-b border-gray-200 bg-gradient-to-r from-blue-600 to-blue-700 text-white">
                <h1 class="text-xl font-bold">ê³ ê¸‰ í•œêµ­ì–´ ë¬¸ë²•</h1>
                <p class="text-sm text-blue-100">Korean Grammar in Use - Advanced</p>
                <div class="flex gap-2 mt-3">
                    <span class="chapter-badge">âœ… 145 Resources</span>
                    <span class="chapter-badge">ğŸ“š 22 Chapters</span>
                </div>
            </div>
            <nav id="chapter-nav" class="p-3 space-y-2">
                <!-- Navigation will be populated by JavaScript -->
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-6 lg:p-8">
            <div class="max-w-5xl mx-auto">
                <div class="mb-8">
                    <input type="text" id="search-input" placeholder="ë¬¸ë²• ê²€ìƒ‰... (ì˜ˆ: -ëŠë‹ˆ, -ë‹¤ê°€, -ë§Œí¼)" 
                           class="w-full px-6 py-4 text-lg border-2 border-gray-300 rounded-full focus:ring-4 focus:ring-blue-500 focus:border-blue-500 transition shadow-lg">
                </div>
                
                <div class="mb-8 pb-4 border-b-2 border-gray-200" id="content-header">
                    <h2 id="chapter-title" class="text-3xl font-bold text-gray-800"></h2>
                    <p id="chapter-subtitle" class="text-lg text-gray-600 mt-2"></p>
                </div>

                <div id="grammar-cards-container">
                    <!-- Content will be populated by JavaScript -->
                </div>

            </div>
        </main>
    </div>

    <script>
        // Content now loaded from grammar.json only
        let grammarData = [];
        /* INLINE_LEGACY_CONTENT
        let grammarData_legacy = [
            // Chapter 1: Expressing choices
            { 
                chapter: 1, 
                title: 'ì„ íƒì„ ë‚˜íƒ€ë‚¼ ë•Œ', 
                subtitle: 'Expressing choices', 
                pattern: '-ëŠë‹ˆ', 
                example: 'ë¹„ ì˜¤ëŠë‹ˆ ì°¨ë¼ë¦¬ ì§‘ì— ìˆì„ë˜.', 
                tip: 'Use this when choosing the "lesser of two evils." Both options are undesirable, but you\'re picking the one that\'s slightly better. Often used with ì°¨ë¼ë¦¬ (rather).', 
                videoUrl: 'https://www.youtube.com/watch?v=iVArQbPOFX4', 
                videoTitle: 'How to use -ëŠë‹ˆ (Rather than...)', 
                channel: 'KoreanClass101',
                resourceType: 'video',
                resourceNote: 'Directly teaches -ëŠë‹ˆ with clear examples and comparisons to similar patterns'
            },
            { 
                chapter: 1, 
                title: 'ì„ íƒì„ ë‚˜íƒ€ë‚¼ ë•Œ', 
                subtitle: 'Expressing choices', 
                pattern: '-(ìœ¼)ã„¹ ë°”ì—ì•¼', 
                example: 'ëŠ¦ê²Œ ì¶œë°œí•  ë°”ì—ì•¼ ì•ˆ ê°€ëŠ” ê²Œ ë‚«ì£ .', 
                tip: 'Stronger than -ëŠë‹ˆ. It implies that because the first option is so bad, doing the second (often opposite) action is a much better choice.', 
                videos: [
                    { url: 'https://www.youtube.com/watch?v=8MRi7HQefG0', title: 'Advanced Korean Grammar: -(ìœ¼)ã„¹ ë°”ì—ì•¼', channel: 'Korean Studio' },
                    { url: 'https://www.youtube.com/watch?v=fY9F_vBjMcQ', title: '-(ìœ¼)ã„¹ ë°”ì—(ì•¼)', channel: 'Tammy Korean' }
                ],
                resourceType: 'video',
                resourceNote: 'Two focused lessons presenting nuances and examples from different instructors'
            },
            { 
                chapter: 1, 
                title: 'ì„ íƒì„ ë‚˜íƒ€ë‚¼ ë•Œ', 
                subtitle: 'Expressing choices', 
                pattern: '-ê±´ -ê±´', 
                example: 'ë‚ ì”¨ê°€ ë¥ê±´ ì¶¥ê±´ ìš´ë™ì€ í•´ì•¼ í•´ìš”.', 
                tip: 'Connects two contrasting words to mean "regardless of whether it\'s A or B." The outcome remains the same.', 
                videos: [
                    { url: 'https://www.youtube.com/watch?v=ucgcrqi5iY8', title: 'Korean Advanced Grammar â”‚-ê±´', channel: 'masterTOPIK' },
                    { url: 'https://www.youtube.com/watch?v=BiM2f7O0xd0', title: '-ê±´ -ê±´', channel: 'ê¹€ê´‘ìˆœ Korean' }
                ],
                resourceType: 'video',
                resourceNote: 'Two solid explanations; one TOPIK-oriented, one usage-focused'
            },

            // Chapter 2: Reporting/quoting
            { 
                chapter: 2, 
                title: 'ì¸ìš©ì„ ë‚˜íƒ€ë‚¼ ë•Œ', 
                subtitle: 'Reporting / quoting', 
                pattern: '-ë‹¤ë©´ì„œ(ìš”)', 
                example: 'ë‚´ì¼ ë¹„ê°€ ì˜¨ë‹¤ë©´ì„œìš”?', 
                tip: 'Used to confirm information you heard from someone else. Often has a questioning tone, seeking confirmation.', 
                videoUrl: 'https://www.youtube.com/watch?v=Ow8EyRiAEqQ', 
                videoTitle: 'ë‹¤ë©´ì„œìš” vs ë‹¤ë‹ˆê¹Œìš” - Differences Explained', 
                channel: 'Korean with Ina',
                resourceType: 'video',
                resourceNote: 'Compares similar patterns to prevent confusion'
            },
            { 
                chapter: 2, 
                title: 'ì¸ìš©ì„ ë‚˜íƒ€ë‚¼ ë•Œ', 
                subtitle: 'Reporting / quoting', 
                pattern: '-ëŒ€ìš”/-ë˜ìš”', 
                example: 'ë¯¼ìˆ˜ê°€ ë‚´ì¼ ì˜¨ëŒ€ìš”.', 
                tip: 'Used to report what someone else said. -ëŒ€ìš” for statements, -ë˜ìš” for questions/commands.', 
                videoUrl: 'https://www.youtube.com/watch?v=Ow8EyRiAEqQ', 
                videoTitle: 'ëŒ€ìš” & -(ì´)ë˜ìš” grammar / Intermediate Level', 
                channel: 'Korean Practice Channel',
                resourceType: 'video',
                resourceNote: 'Clear explanation with conversation examples'
            },
            { 
                chapter: 2, 
                title: 'ì¸ìš©ì„ ë‚˜íƒ€ë‚¼ ë•Œ', 
                subtitle: 'Reporting / quoting', 
                pattern: '-ë‹¤ê¸°ì—', 
                example: 'ë§›ìˆë‹¤ê¸°ì— ë¨¹ì–´ë´¤ì–´ìš”.', 
                tip: 'Used when you do something based on what you heard from others. Shows the reason for your action.', 
                videoUrl: 'https://www.youtube.com/watch?v=sbn1tCGvFSg', 
                videoTitle: '-ë‹¤ê¸°ì—', 
                channel: 'Tammy Korean',
                resourceType: 'video',
                resourceNote: 'Focused lesson with practical examples'
            },
            { 
                chapter: 2, 
                title: 'ì¸ìš©ì„ ë‚˜íƒ€ë‚¼ ë•Œ', 
                subtitle: 'Reporting / quoting', 
                pattern: '-ë‹¤ë‹ˆê¹Œ(ìš”)', 
                example: 'ì•„ë‹ˆë¼ë‹ˆê¹Œìš”!', 
                tip: 'Used to emphasize or insist on what you\'re saying, often when the listener doesn\'t believe you.', 
                resourceUrl: 'https://www.howtostudykorean.com/unit-3-intermediate-korean-grammar/lessons-59-66/lesson-63/', 
                resourceTitle: 'Lesson 63: Quoting in Korean', 
                resourceType: 'Interactive Article',
                resourceNote: 'Comprehensive guide with interactive exercises'
            },

            // Chapter 3: Nominalization
            { 
                chapter: 3, 
                title: 'ëª…ì‚¬í™”', 
                subtitle: 'Nominalisation & fact statements', 
                pattern: '-ê¸°', 
                example: 'í•œêµ­ì–´ ë°°ìš°ê¸°ê°€ ì–´ë ¤ì›Œìš”.', 
                tip: 'Turns verbs into nouns. Used for general activities or habits.', 
                videoUrl: 'https://www.youtube.com/watch?v=4IwwOdzmZ6Y', 
                videoTitle: 'Learn Korean Ep. 10: Nominalization | ~ê¸°, ~ëŠ” ê²ƒ, ~ìŒ/ã…', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Compares all nominalization forms'
            },
            { 
                chapter: 3, 
                title: 'ëª…ì‚¬í™”', 
                subtitle: 'Nominalisation & fact statements', 
                pattern: '-ìŒ/-ã…', 
                example: 'ê·¸ì˜ ì˜ëª»ì„ì´ í™•ì‹¤í•´ìš”.', 
                tip: 'Formal nominalization. Often used in written Korean and formal speech.', 
                resourceUrl: 'https://www.howtostudykorean.com/unit-2-lower-intermediate-korean-grammar/unit-2-lessons-42-50/lesson-44/', 
                resourceTitle: 'Lesson 44: Nominalization ~ëŠ” ê²ƒ vs ~ê¸° vs ~ã…/ìŒ', 
                resourceType: 'Interactive Article',
                resourceNote: 'Detailed comparison with practice quizzes'
            },
            { 
                chapter: 3, 
                title: 'ëª…ì‚¬í™”', 
                subtitle: 'Nominalisation & fact statements', 
                pattern: '-ëŠ” ê²ƒ', 
                example: 'í•œêµ­ì–´ë¥¼ ë°°ìš°ëŠ” ê²ƒì´ ì¬ë¯¸ìˆì–´ìš”.', 
                tip: 'Most common way to nominalize verbs. Can be shortened to -ëŠ” ê±° in casual speech.', 
                videoUrl: 'https://www.youtube.com/watch?v=4IwwOdzmZ6Y', 
                videoTitle: 'Learn Korean Ep. 10: Nominalization | ~ê¸°, ~ëŠ” ê²ƒ, ~ìŒ/ã…', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Practical usage in everyday conversation'
            },
            { 
                chapter: 3, 
                title: 'ëª…ì‚¬í™”', 
                subtitle: 'Nominalisation & fact statements', 
                pattern: '-ë°”', 
                example: 'ì œê°€ ì•„ëŠ” ë°”ë¡œëŠ”...', 
                tip: 'Formal dependent noun meaning "fact" or "thing." Often used in formal contexts.', 
                videoUrl: 'https://www.youtube.com/watch?v=tPiV4q28F5Y', 
                videoTitle: 'Live Korean Class | [Advanced] Dependent Noun ë°” vs ê²ƒ', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Live class format with Q&A'
            },
            { 
                chapter: 3, 
                title: 'ëª…ì‚¬í™”', 
                subtitle: 'Nominalisation & fact statements', 
                pattern: '-ëŠ” ë°”', 
                example: 'ì œê°€ ë³´ëŠ” ë°”ë¡œëŠ” í‹€ë ¸ì–´ìš”.', 
                tip: 'Formal way to express "from what I see/know." Used in formal speech and writing.', 
                videoUrl: 'https://www.youtube.com/watch?v=tPiV4q28F5Y', 
                videoTitle: 'Live Korean Class | [Advanced] Dependent Noun ë°” vs ê²ƒ', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Detailed explanation with formal examples'
            },

            // Chapter 4: Formal causes
            { 
                chapter: 4, 
                title: 'ì›ì¸ê³¼ ì´ìœ ', 
                subtitle: 'Formal causes', 
                pattern: '-ëŠ” í†µì—', 
                example: 'ì•„ì´ë“¤ì´ ë– ë“œëŠ” í†µì— ì ì„ ëª» ì¤ì–´ìš”.', 
                tip: 'Used to express a chaotic or troublesome situation that causes a negative result.', 
                videoUrl: 'https://www.youtube.com/watch?v=WRb83QkeHw0', 
                videoTitle: 'Korean Grammar Intermediate-level (158) VëŠ” í†µì—, VëŠ” ë°”ëŒì—', 
                channel: 'Teacher Jinee\'s Korean Class',
                resourceType: 'video',
                resourceNote: 'Compares similar cause expressions'
            },
            { 
                chapter: 4, 
                title: 'ì›ì¸ê³¼ ì´ìœ ', 
                subtitle: 'Formal causes', 
                pattern: '-(ìœ¼)ë¡œ ë§ë¯¸ì•”ì•„', 
                example: 'íƒœí’ìœ¼ë¡œ ë§ë¯¸ì•”ì•„ í”¼í•´ê°€ ì»¸ì–´ìš”.', 
                tip: 'Very formal way to express cause. Often used in news, reports, and formal writing.', 
                videoUrl: 'https://www.youtube.com/watch?v=LFX7S2yXAJA', 
                videoTitle: '[#ê³ ê¸‰ë¬¸ë²•] ìœ¼ë¡œ/ë¡œë§ë¯¸ì•”ì•„ #ë§ë¯¸ì•”ì•„', 
                channel: 'Korean Advanced Grammar',
                resourceType: 'video',
                resourceNote: 'News-style examples and usage'
            },
            { 
                chapter: 4, 
                title: 'ì›ì¸ê³¼ ì´ìœ ', 
                subtitle: 'Formal causes', 
                pattern: '-(ìœ¼)ë¡œ ì¸í•´ì„œ', 
                example: 'ì‚¬ê³ ë¡œ ì¸í•´ì„œ ì§€ê°í–ˆì–´ìš”.', 
                tip: 'Formal way to express "due to" or "because of." Common in formal speech and writing.', 
                videoUrl: 'https://www.youtube.com/watch?v=ouuBf8opagA', 
                videoTitle: '[Korean/Coreano] Nìœ¼ë¡œ ì¸í•´ì„œ (because of) grammar', 
                channel: 'HANIJEMI Korean Lesson',
                resourceType: 'video',
                resourceNote: 'Business Korean usage examples'
            },

            // Chapter 5: Hypothesis & concession
            { 
                chapter: 5, 
                title: 'ê°€ì •Â·ì–‘ë³´', 
                subtitle: 'Hypothesis & concession', 
                pattern: '-(ìœ¼)ã„¹ì§€ë¼ë„', 
                example: 'ë¹„ê°€ ì˜¬ì§€ë¼ë„ ê°ˆ ê±°ì˜ˆìš”.', 
                tip: 'Formal way to say "even if." More formal than -ë”ë¼ë„.', 
                videoUrl: 'https://www.youtube.com/watch?v=AdsnFvvlSx4', 
                videoTitle: 'Live Korean Class | [Advanced] ~ë”ë¼ë„ & ~ã„¹ì§€ë¼ë„ "Even If"', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Compares formal and informal versions'
            },
            { 
                chapter: 5, 
                title: 'ê°€ì •Â·ì–‘ë³´', 
                subtitle: 'Hypothesis & concession', 
                pattern: '-ë”ë¼ë„', 
                example: 'í˜ë“¤ë”ë¼ë„ í¬ê¸°í•˜ì§€ ë§ˆì„¸ìš”.', 
                tip: 'Used to express "even if" or "even though." Shows concession.', 
                videoUrl: 'https://www.youtube.com/watch?v=AdsnFvvlSx4', 
                videoTitle: 'Live Korean Class | [Advanced] ~ë”ë¼ë„ & ~ã„¹ì§€ë¼ë„ "Even If"', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Practical conversation examples'
            },
            { 
                chapter: 5, 
                title: 'ê°€ì •Â·ì–‘ë³´', 
                subtitle: 'Hypothesis & concession', 
                pattern: '-(ìœ¼)ã„´ë“¤', 
                example: 'ëˆì´ ë§ì€ë“¤ í–‰ë³µí• ê¹Œìš”?', 
                tip: 'Rhetorical "even if." Often used in questions to suggest the answer is negative.', 
                videoUrl: 'https://www.youtube.com/watch?v=SIlPBJZokg4', 
                videoTitle: 'Live Korean Class | [Intermediate] ë¦¬ê°€ ì—†ë‹¤ "There\'s no way"', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Focus on rhetorical usage'
            },
            { 
                chapter: 5, 
                title: 'ê°€ì •Â·ì–‘ë³´', 
                subtitle: 'Hypothesis & concession', 
                pattern: '-(ìœ¼)ã„¹ ë§ì •', 
                example: 'ì£½ì„ ë§ì • í¬ê¸°í•˜ì§€ ì•Šê² ì–´ìš”.', 
                tip: 'Strong expression meaning "would rather" or "even if it means." Shows extreme determination.', 
                videoUrl: 'https://www.youtube.com/watch?v=dUEEijhzYi0', 
                videoTitle: 'ê³ ê¸‰ ë¬¸ë²• / "-ì„ë§ì •" ë¬¸ë²• ë°°ìš°ê¸° / Learning Korean', 
                channel: 'Korean Advanced Grammar',
                resourceType: 'video',
                resourceNote: 'Dramatic examples from K-dramas'
            },

            // Chapter 6: Sequence & opportunity
            { 
                chapter: 6, 
                title: 'ìˆœì°¨ & ê¸°íšŒ', 
                subtitle: 'Sequence & "while I\'m at it"', 
                pattern: '-ê³ ì„œì•¼', 
                example: 'ìˆ™ì œë¥¼ ë‹¤ í•˜ê³ ì„œì•¼ ë†€ ìˆ˜ ìˆì–´ìš”.', 
                tip: 'Emphasizes that something happens only after completing the first action.', 
                resourceUrl: 'https://www.howtostudykorean.com/unit-3-intermediate-korean-grammar/lessons-67-75/lesson-72/', 
                resourceTitle: 'Lesson 72: ~ê³ ì„œì•¼, ~ê³  ë‚˜ì„œì•¼', 
                resourceType: 'Interactive Article',
                resourceNote: 'Detailed comparison with similar patterns'
            },
            { 
                chapter: 6, 
                title: 'ìˆœì°¨ & ê¸°íšŒ', 
                subtitle: 'Sequence & "while I\'m at it"', 
                pattern: '-(ìœ¼)ã„´/ëŠ” ê¹€ì—', 
                example: 'ë§ˆíŠ¸ì— ê°€ëŠ” ê¹€ì— ìš°ìœ ë„ ì‚¬ì„¸ìš”.', 
                tip: 'Used when doing something additional "while you\'re at it" or taking advantage of an opportunity.', 
                videoUrl: 'https://www.youtube.com/watch?v=H0ykZKNF0JU', 
                videoTitle: 'Korean Grammar - ~ê¹€ì— (While you\'re at it)', 
                channel: 'Learn Korean with KoreanClass101.com',
                resourceType: 'video',
                resourceNote: 'Practical daily life examples'
            },
            { 
                chapter: 6, 
                title: 'ìˆœì°¨ & ê¸°íšŒ', 
                subtitle: 'Sequence & "while I\'m at it"', 
                pattern: '-ê¸° ìœ„í•´(ì„œ)', 
                example: 'í•œêµ­ì–´ë¥¼ ë°°ìš°ê¸° ìœ„í•´ì„œ í•œêµ­ì— ì™”ì–´ìš”.', 
                tip: 'Expresses purpose - "in order to" or "for the purpose of."', 
                videoUrl: 'https://www.youtube.com/watch?v=zVUqw32OSTI', 
                videoTitle: 'Korean Grammar - How to use ìœ„í•´ or ìœ„í•´ì„œ', 
                channel: 'Korean Grammar Channel',
                resourceType: 'video',
                resourceNote: 'Clear beginner to advanced progression'
            },

            // Chapter 7: Conditions & dependence
            { 
                chapter: 7, 
                title: 'ì¡°ê±´ & ì˜ì¡´', 
                subtitle: 'Conditions & dependence', 
                pattern: '-ëŠ” í•œ', 
                example: 'ì‚´ì•„ìˆëŠ” í•œ í¬ê¸°í•˜ì§€ ì•Šê² ì–´ìš”.', 
                tip: 'Means "as long as" or "while." Shows a condition that must be maintained.', 
                videoUrl: 'https://www.youtube.com/watch?v=ijmgIvPwp5k', 
                videoTitle: 'Live Korean Class | [Advanced] í•œ "As long as"', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Live class format with student questions'
            },
            { 
                chapter: 7, 
                title: 'ì¡°ê±´ & ì˜ì¡´', 
                subtitle: 'Conditions & dependence', 
                pattern: '-ë…¸ë¼ë©´', 
                example: 'ê³„ì† ê³µë¶€í•˜ë…¸ë¼ë©´ ì‹¤ë ¥ì´ ëŠ˜ ê±°ì˜ˆìš”.', 
                tip: 'Means "if you keep doing" something. Shows a continuous action leading to a result.', 
                videoUrl: 'https://www.youtube.com/watch?v=UjCe3PGKtAU', 
                videoTitle: 'Live Korean Class | [Advanced] ~ë‹¤ ë³´ë©´ "If you keep..."', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Focus on continuous action forms'
            },
            { 
                chapter: 7, 
                title: 'ì¡°ê±´ & ì˜ì¡´', 
                subtitle: 'Conditions & dependence', 
                pattern: '-ê¸° ë‚˜ë¦„ì´ë‹¤', 
                example: 'ì„±ê³µì€ ë…¸ë ¥í•˜ê¸° ë‚˜ë¦„ì´ì—ìš”.', 
                tip: 'Means "it depends on" how you do something. Shows that the result varies based on approach.', 
                videoUrl: 'https://www.youtube.com/watch?v=ZKq_VEqSf9k', 
                videoTitle: 'Depending on (~ì— ë”°ë¼ì„œ, ë‚˜ë¦„, ë‹¤ë¥´ë‹¤) | Live Class Abridged', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Multiple dependency expressions compared'
            },
            { 
                chapter: 7, 
                title: 'ì¡°ê±´ & ì˜ì¡´', 
                subtitle: 'Conditions & dependence', 
                pattern: '-ê¸°ì— ë‹¬ë ¤ ìˆë‹¤', 
                example: 'ê²°ê³¼ëŠ” ë‹¹ì‹ ì˜ ë…¸ë ¥ì— ë‹¬ë ¤ ìˆì–´ìš”.', 
                tip: 'Means "depends on" or "is up to." Shows dependency on a factor.', 
                resourceUrl: 'https://www.howtostudykorean.com/unit-6/lessons-142-150/lesson-149/', 
                resourceTitle: 'Lesson 149: To depend on: ~ì— ë‹¬ë ¤ ìˆë‹¤', 
                resourceType: 'Interactive Article',
                resourceNote: 'Comprehensive guide with quizzes'
            },

            // Chapter 8: Listing hectic actions
            { 
                chapter: 8, 
                title: 'ë”°ë¡œÂ·ê°™ì´', 
                subtitle: 'Listing hectic actions', 
                pattern: '-(ìœ¼)ë´ -(ìœ¼)ë´', 
                example: 'ì²­ì†Œí•˜ë´ ìš”ë¦¬í•˜ë´ ë°”ë¹ ìš”.', 
                tip: 'Lists multiple actions that make someone busy or overwhelmed. Shows hectic situations.', 
                videoUrl: 'https://www.youtube.com/watch?v=VKIlNQDnkWU', 
                videoTitle: 'Live Korean Class [Advanced] "About to" ~ë½ ë§ë½ í•˜ë‹¤ & ~ë‘ ë§ë‘ í•˜ë‹¤', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Focus on busy/lifestyle expressions'
            },
            { 
                chapter: 8, 
                title: 'ë”°ë¡œÂ·ê°™ì´', 
                subtitle: 'Listing hectic actions', 
                pattern: '-(ì´)ë©° -(ì´)ë©°', 
                example: 'ì±…ì´ë©° íœì´ë©° ëª¨ë‘ ê°€ì ¸ê°€ì„¸ìš”.', 
                tip: 'Lists items or actions inclusively. Similar to "including" or "such as."', 
                videoUrl: 'https://www.youtube.com/watch?v=uejoXZnxr2k', 
                videoTitle: 'Korean Grammar 201: V/A-ìœ¼ë©°/ë©°, N-ì´ë‹¤ + ë©°', 
                channel: 'Basic Korean',
                resourceType: 'video',
                resourceNote: 'Clear listing expressions explained'
            },

            // Chapter 9: Contrast
            { 
                chapter: 9, 
                title: 'ëŒ€ì¡°', 
                subtitle: 'Contrast', 
                pattern: '-(ìœ¼)ã„´ ë°˜ë©´(ì—)', 
                example: 'í˜•ì€ í‚¤ê°€ í° ë°˜ë©´ì— ë™ìƒì€ ì‘ì•„ìš”.', 
                tip: 'Used to show contrast between two things. Means "on the other hand" or "whereas."', 
                videoUrl: 'https://www.youtube.com/watch?v=5opH-v0kcJo', 
                videoTitle: 'Learn Korean Ep. 116: ë°˜ë©´ì— "On the Other Hand"', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Detailed contrast expressions'
            },
            { 
                chapter: 9, 
                title: 'ëŒ€ì¡°', 
                subtitle: 'Contrast', 
                pattern: '-ëŠ” ëŒ€ì‹ (ì—)', 
                example: 'ëˆ ëŒ€ì‹ ì— ì¹´ë“œë¡œ ê³„ì‚°í• ê²Œìš”.', 
                tip: 'Means "instead of" or "in place of." Shows substitution or alternative choice.', 
                resourceUrl: 'https://www.howtostudykorean.com/unit-3-intermediate-korean-grammar/lessons-67-75/lesson-69/', 
                resourceTitle: 'Lesson 69: Instead of: ëŒ€ì‹ ì—', 
                resourceType: 'Interactive Article',
                resourceNote: 'Comprehensive guide with exercises'
            },

            // Chapter 10: Similarity & virtuality
            { 
                chapter: 10, 
                title: 'ìœ ì‚¬', 
                subtitle: 'Similarity & virtuality', 
                pattern: '-(ìœ¼)ã„´ ì…ˆì´ë‹¤', 
                example: 'ì´ë¯¸ ëë‚œ ì…ˆì´ì—ìš”.', 
                tip: 'Means "practically" or "as good as." Shows that something is virtually the case.', 
                videoUrl: 'https://www.youtube.com/watch?v=T6KJkF2nVUY', 
                videoTitle: 'ì…ˆì´ë‹¤', 
                channel: 'Teacher Jinee',
                resourceType: 'video',
                resourceNote: 'Practical virtual completion expressions'
            },
            { 
                chapter: 10, 
                title: 'ìœ ì‚¬', 
                subtitle: 'Similarity & virtuality', 
                pattern: '-(ìœ¼)ë‚˜ ë§ˆë‚˜', 
                example: 'ë§í•´ë„ ì†Œìš©ì—†ìœ¼ë‹ˆê¹Œ ë§í•˜ë‚˜ ë§ˆë‚˜ì˜ˆìš”.', 
                tip: 'Means "whether or not" with the implication that it doesn\'t matter.', 
                videoUrl: 'https://www.youtube.com/watch?v=uvEpMDzhNNQ', 
                videoTitle: 'Learn Korean Ep. 113: (ìœ¼)ë‚˜ ë§ˆë‚˜ and ë´¤ì "No Matter"', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Futility expressions explained'
            },
            { 
                chapter: 10, 
                title: 'ìœ ì‚¬', 
                subtitle: 'Similarity & virtuality', 
                pattern: '-ëŠ” ê²ƒê³¼ ë‹¤ë¦„ì—†ë‹¤', 
                example: 'ì´ê±´ ê±°ì§“ë§í•˜ëŠ” ê²ƒê³¼ ë‹¤ë¦„ì—†ì–´ìš”.', 
                tip: 'Means "no different from" or "the same as." Shows equivalence.', 
                videoUrl: 'https://www.youtube.com/watch?v=YzdGqMsxz5k', 
                videoTitle: '[ Intermediate Korean 57 ] â€“(ì´)ë‚˜ ë‹¤ë¦„ì—†ë‹¤ , â€“ë§ˆì € , â€“ê³ ë§Œ ìˆë‹¤', 
                channel: 'Tammy Korean',
                resourceType: 'video',
                resourceNote: 'Equivalence expressions with examples'
            },

            // Chapter 11: Addition & inclusion
            { 
                chapter: 11, 
                title: 'ì¶”ê°€Â·í¬í•¨', 
                subtitle: 'Addition & inclusion', 
                pattern: '-(ì´)ê±°ë‹ˆì™€', 
                example: 'ë¹„ì‹¸ê±°ë‹ˆì™€ ë§›ë„ ì—†ì–´ìš”.', 
                tip: 'Means "not only... but also." Used to add negative information.', 
                videoUrl: 'https://www.youtube.com/watch?v=a8tL1B26ZN4', 
                videoTitle: 'ê±°ë‹ˆì™€ "Not only" | Live Class Abridged', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Negative addition expressions'
            },
            { 
                chapter: 11, 
                title: 'ì¶”ê°€Â·í¬í•¨', 
                subtitle: 'Addition & inclusion', 
                pattern: '-ì€/ëŠ” ë¬¼ë¡ ì´ê³ ', 
                example: 'í•œêµ­ì–´ëŠ” ë¬¼ë¡ ì´ê³  ì¤‘êµ­ì–´ë„ í•  ìˆ˜ ìˆì–´ìš”.', 
                tip: 'Means "not to mention" or "of course." Used to add information that\'s even more impressive.', 
                videoUrl: 'https://www.youtube.com/watch?v=xw3RloPlQJQ', 
                videoTitle: 'GU5.6 ~ì€/ëŠ” ë¬¼ë¡ ì´ê³  not to mention, to say nothing of', 
                channel: 'Korean Grammar Channel',
                resourceType: 'video',
                resourceNote: 'Positive addition expressions'
            },
            { 
                chapter: 11, 
                title: 'ì¶”ê°€Â·í¬í•¨', 
                subtitle: 'Addition & inclusion', 
                pattern: '-ì¡°ì°¨/-ë§ˆì €', 
                example: 'ì¹œêµ¬ì¡°ì°¨ ë‚˜ë¥¼ ë¯¿ì§€ ì•Šì•„ìš”.', 
                tip: 'Means "even" with emphasis. -ì¡°ì°¨ is more formal, -ë§ˆì € more emotional.', 
                videoUrl: 'https://www.youtube.com/watch?v=bHLnGFM3bkw', 
                videoTitle: 'ë„, ê¹Œì§€, ë§ˆì €, ì¡°ì°¨ "Even" | Live Class Abridged', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Comparison of all "even" expressions'
            },
            { 
                chapter: 11, 
                title: 'ì¶”ê°€Â·í¬í•¨', 
                subtitle: 'Addition & inclusion', 
                pattern: '-ëŠë‹ˆë§Œ ëª»í•˜ë‹¤', 
                example: 'ì´ ìŒì‹ì€ ë¼ë©´ë³´ë‹¤ ëŠë‹ˆë§Œ ëª»í•´ìš”.', 
                tip: 'Means "not as good as" or "worse than." Shows inferiority.', 
                videoUrl: 'https://www.youtube.com/watch?v=HgIX6NUqWsI', 
                videoTitle: 'Difference between ëŠë‹ˆë§Œ ëª»í•˜ë‹¤ and ë§Œ ëª»í•˜ë‹¤', 
                channel: 'Korean Language Teacher',
                resourceType: 'video',
                resourceNote: 'Clear comparison of inferiority expressions'
            },

            // Chapter 12: Habits & tendencies
            { 
                chapter: 12, 
                title: 'ìŠµê´€ & íƒœë„', 
                subtitle: 'Habits & tendencies', 
                pattern: '-ê³¤ í•˜ë‹¤', 
                example: 'ì–´ë¦´ ë•Œ ìì£¼ ë†€ëŸ¬ ê°€ê³¤ í–ˆì–´ìš”.', 
                tip: 'Expresses past habits or repeated actions. Similar to "used to."', 
                videoUrl: 'https://www.youtube.com/watch?v=CAnB-QRas_c', 
                videoTitle: 'TOPIK II ë¬¸ë²• ìˆ˜ì—… (6) : [ ê³¤í•˜ë‹¤, ê¸° ì¼ì‘¤ì´ë‹¤, ì•„ ëŒ€ë‹¤ ]', 
                channel: 'Korean TOPIK Study',
                resourceType: 'video',
                resourceNote: 'TOPIK-focused habit expressions'
            },
            { 
                chapter: 12, 
                title: 'ìŠµê´€ & íƒœë„', 
                subtitle: 'Habits & tendencies', 
                pattern: '-ì•„/ì–´ ëŒ€ë‹¤', 
                example: 'ì•„ì´ê°€ ê³„ì† ìš¸ì–´ ëŒ€ìš”.', 
                tip: 'Shows continuous or repeated action, often with negative connotation.', 
                videoUrl: 'https://www.youtube.com/watch?v=4hqGCADL0gg', 
                videoTitle: '~ëŒ€ë‹¤ Habits | Live Class Abridged', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Negative habit expressions'
            },
            { 
                chapter: 12, 
                title: 'ìŠµê´€ & íƒœë„', 
                subtitle: 'Habits & tendencies', 
                pattern: '-ê¸° ì¼ì‘¤ì´ë‹¤', 
                example: 'ê·¸ëŠ” ì•½ì†ì— ëŠ¦ê¸° ì¼ì‘¤ì˜ˆìš”.', 
                tip: 'Means "it\'s common for" or "tends to." Shows frequent occurrence of undesirable things.', 
                videoUrl: 'https://www.youtube.com/watch?v=CAnB-QRas_c', 
                videoTitle: 'TOPIK II ë¬¸ë²• ìˆ˜ì—… (6) : [ ê³¤í•˜ë‹¤, ê¸° ì¼ì‘¤ì´ë‹¤, ì•„ ëŒ€ë‹¤ ]', 
                channel: 'Korean TOPIK Study',
                resourceType: 'video',
                resourceNote: 'Undesirable habits explained'
            },

            // Chapter 13: Degree & emphasis
            { 
                chapter: 13, 
                title: 'ì •ë„Â·ê°•ì¡°', 
                subtitle: 'Degree & emphasis', 
                pattern: 'ì—¬ê°„ -ì§€ ì•Šë‹¤', 
                example: 'ì—¬ê°„ ì–´ë µì§€ ì•Šì•„ìš”.', 
                tip: 'Emphasizes degree - means "extremely" or "quite." Double negative for emphasis.', 
                videoUrl: 'https://www.youtube.com/watch?v=eMJ2vrfy-i8', 
                videoTitle: 'Korean expression: ì—¬ê°„ [intermediate/Advanced Korean]', 
                channel: 'Korean Grammar Channel',
                resourceType: 'video',
                resourceNote: 'Emphasis expressions with examples'
            },
            { 
                chapter: 13, 
                title: 'ì •ë„Â·ê°•ì¡°', 
                subtitle: 'Degree & emphasis', 
                pattern: '-(ìœ¼)ã„¹ ë”°ë¦„ì´ë‹¤', 
                example: 'ê°ì‚¬í•  ë”°ë¦„ì…ë‹ˆë‹¤.', 
                tip: 'Formal expression meaning "just" or "only." Shows humility or limitation.', 
                videoUrl: 'https://www.youtube.com/watch?v=W_VNm0uffBM', 
                videoTitle: 'Learn Korean Ep. 127: ë¿ì´ë‹¤ & ë”°ë¦„ì´ë‹¤ "Only"', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Comparison of limitation expressions'
            },
            { 
                chapter: 13, 
                title: 'ì •ë„Â·ê°•ì¡°', 
                subtitle: 'Degree & emphasis', 
                pattern: '-ê¸°(ê°€) ì´ë¥¼ ë° ì—†ë‹¤', 
                example: 'ê¸°ì˜ê¸°ê°€ ì´ë¥¼ ë° ì—†ì–´ìš”.', 
                tip: 'Expresses maximum degree - "extremely" or "to the utmost degree."', 
                resourceUrl: 'https://studying-korean.tistory.com/197', 
                resourceTitle: 'A-ê¸°(ê°€) ì´ë¥¼ ë° ì—†ë‹¤ Korean grammar', 
                resourceType: 'Interactive Article',
                resourceNote: 'Detailed guide with examples'
            },

            // Chapter 14: Intentions & plans
            { 
                chapter: 14, 
                title: 'ì˜ë„', 
                subtitle: 'Intentions & plans', 
                pattern: '-(ìœ¼)ë ¤ë“¤ë‹¤', 
                example: 'ìê¾¸ ê°„ì„­í•˜ë ¤ ë“¤ì–´ìš”.', 
                tip: 'Shows attempt or intention to do something, often with negative connotation.', 
                videoUrl: 'https://www.youtube.com/watch?v=SqBA0JHaXug', 
                videoTitle: 'V-(ìœ¼)ë ¤ê³  ë“¤ë‹¤', 
                channel: 'Korean Grammar (Lecture)',
                resourceType: 'video',
                resourceNote: 'Negative intention expressions'
            },
            { 
                chapter: 14, 
                title: 'ì˜ë„', 
                subtitle: 'Intentions & plans', 
                pattern: '-(ìœ¼)ã„¹ ì‘ì •ì´ë‹¤', 
                example: 'ì´ë²ˆì—ëŠ” ê¼­ ì„±ê³µí•  ì‘ì •ì´ì—ìš”.', 
                tip: 'Shows firm decision or determination. Stronger than simple intention.', 
                resourceUrl: 'https://www.howtostudykorean.com/unit-2-lower-intermediate-korean-grammar/unit-2-lessons-42-50/lesson-50/', 
                resourceTitle: 'Lesson 50: ~ã„¹/ì„ ì˜ˆì •, ê³„íš, ì¤€ë¹„', 
                resourceType: 'Interactive Article',
                resourceNote: 'Determination expressions with quizzes'
            },

            // Chapter 15: Guess & probability
            { 
                chapter: 15, 
                title: 'ì¶”ì¸¡Â·ê°€ëŠ¥ì„±', 
                subtitle: 'Guess & probability', 
                pattern: '-(ìœ¼)ã„¹ ë²•í•˜ë‹¤', 
                example: 'ê·¸ëŸ´ ë²•í•´ìš”.', 
                tip: 'Expresses likelihood or probability. Means "it\'s likely" or "it\'s probable."', 
                videoUrl: 'https://www.youtube.com/watch?v=OBeYMklsf64', 
                videoTitle: 'Live Korean Class [Advanced] ~ë²•í•˜ë‹¤ "Likely..."', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Probability expressions explained'
            },
            { 
                chapter: 15, 
                title: 'ì¶”ì¸¡Â·ê°€ëŠ¥ì„±', 
                subtitle: 'Guess & probability', 
                pattern: '-(ìœ¼)ã„¹ ë¦¬ê°€ ì—†ë‹¤', 
                example: 'ê·¸ê°€ ê±°ì§“ë§í•  ë¦¬ê°€ ì—†ì–´ìš”.', 
                tip: 'Expresses impossibility or disbelief. Means "there\'s no way" or "impossible."', 
                videoUrl: 'https://www.youtube.com/watch?v=SIlPBJZokg4', 
                videoTitle: 'Live Korean Class | [Intermediate] ë¦¬ê°€ ì—†ë‹¤ "There\'s no way"', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Impossibility expressions'
            },
            { 
                chapter: 15, 
                title: 'ì¶”ì¸¡Â·ê°€ëŠ¥ì„±', 
                subtitle: 'Guess & probability', 
                pattern: '-(ìœ¼)ã„¹ ìˆ˜ë°–ì— ì—†ë‹¤', 
                example: 'ì´ë ‡ê²Œ í•  ìˆ˜ë°–ì— ì—†ì–´ìš”.', 
                tip: 'Means "have no choice but to" or "can\'t help but." Shows inevitability.', 
                videoUrl: 'https://www.youtube.com/watch?v=8CammJ-KCzw', 
                videoTitle: '[ Intermediate Korean 43 ] â€“ëŠ” ìˆ˜ë°–ì— (ì—†ë‹¤) , â€“ëŠ” ì¤‘ì´ë‹¤ , â€“ëŠë‹ˆ', 
                channel: 'Tammy Korean',
                resourceType: 'video',
                resourceNote: 'Inevitability in context'
            },
            { 
                chapter: 15, 
                title: 'ì¶”ì¸¡Â·ê°€ëŠ¥ì„±', 
                subtitle: 'Guess & probability', 
                pattern: '-(ìœ¼)ã„¹ ìˆ˜ê°€ ì—†ë‹¤', 
                example: 'ë¯¿ì„ ìˆ˜ê°€ ì—†ì–´ìš”.', 
                tip: 'Expresses inability or impossibility. Means "cannot" in the sense of being unable to.', 
                videoUrl: 'https://www.youtube.com/watch?v=iiYtnzNl-mY', 
                videoTitle: 'ì§€ ëª»í•˜ë‹¤ vs (ìœ¼)ã„¹ ìˆ˜ ì—†ë‹¤', 
                channel: 'Korean Grammar Channel',
                resourceType: 'video',
                resourceNote: 'Inability expressions'
            },

            // Chapter 16: Exclusion
            { 
                chapter: 16, 
                title: 'ì œì™¸', 
                subtitle: 'Exclusion', 
                pattern: '-ì—†ì´ëŠ”', 
                example: 'ë‹¹ì‹ ì˜ ë„ì›€ ì—†ì´ëŠ” ë¶ˆê°€ëŠ¥í•´ìš”.', 
                tip: 'Means "without" with emphasis on necessity. Shows that something is essential.', 
                resourceUrl: 'https://www.howtostudykorean.com/unit-3-intermediate-korean-grammar/lessons-67-75/lesson-74/', 
                resourceTitle: 'Lesson 74: It doesn\'t matter/ Regardless of (ìƒê´€ì—†ë‹¤/ìƒê´€ì—†ì´)', 
                resourceType: 'Interactive Article',
                resourceNote: 'Exclusion in various contexts'
            },
            { 
                chapter: 16, 
                title: 'ì œì™¸', 
                subtitle: 'Exclusion', 
                pattern: '-ë§ê³ ëŠ”', 
                example: 'ë„ˆ ë§ê³ ëŠ” ì•„ë¬´ë„ ëª°ë¼ìš”.', 
                tip: 'Means "apart from" or "except for." Shows exclusion with emphasis.', 
                videoUrl: 'https://www.youtube.com/watch?v=H0DP5OAvkPY', 
                videoTitle: 'HOW TO USE ë§ê³  IN KOREAN SENTENCE', 
                channel: 'Korean Grammar Channel',
                resourceType: 'video',
                resourceNote: 'Practical exclusion examples'
            },
            { 
                chapter: 16, 
                title: 'ì œì™¸', 
                subtitle: 'Exclusion', 
                pattern: '-ì™¸ì—ëŠ”', 
                example: 'ì´ê²ƒ ì™¸ì—ëŠ” ë‹¤ë¥¸ ë°©ë²•ì´ ì—†ì–´ìš”.', 
                tip: 'Formal way to say "except for" or "other than." Used in formal contexts.', 
                resourceUrl: 'https://www.howtostudykorean.com/unit-3-intermediate-korean-grammar/lessons-67-75/lesson-71/', 
                resourceTitle: 'Lesson 71: To include (í¬í•¨í•˜ë‹¤), to exclude (ì œì™¸í•˜ë‹¤)', 
                resourceType: 'Interactive Article',
                resourceNote: 'Formal exclusion guide'
            },

            // Chapter 17: Comparison
            { 
                chapter: 17, 
                title: 'ë¹„êµ', 
                subtitle: 'Comparison', 
                pattern: '-ë§Œ ëª»í•˜ë‹¤', 
                example: 'ì´ ì˜í™”ëŠ” ì „ì‘ë§Œ ëª»í•´ìš”.', 
                tip: 'Means "not as good as" or "inferior to." Shows comparison with negative result.', 
                videoUrl: 'https://www.youtube.com/watch?v=pgdbJrozqp4', 
                videoTitle: 'Korean Grammar Intermediate (172) Në§Œ ëª»í•˜ë‹¤. Në§Œ ëª»í•´ìš”. Not as good as', 
                channel: 'Teacher Jinee\'s Korean Class',
                resourceType: 'video',
                resourceNote: 'Negative comparison examples'
            },
            { 
                chapter: 17, 
                title: 'ë¹„êµ', 
                subtitle: 'Comparison', 
                pattern: '-ë§Œí•˜ë‹¤', 
                example: 'ì´ ì¼ì€ í•  ë§Œí•´ìš”.', 
                tip: 'Means "worth doing" or "as much as." Shows comparison or evaluation.', 
                videoUrl: 'https://www.youtube.com/watch?v=JYcXa6oW3_g', 
                videoTitle: 'Learn Korean Ep. 78: "Worth Doing" | ë§Œí•˜ë‹¤', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Worthwhile actions explained'
            },
            { 
                chapter: 17, 
                title: 'ë¹„êµ', 
                subtitle: 'Comparison', 
                pattern: '-ì— ë¹„í•´ì„œ', 
                example: 'ì‘ë…„ì— ë¹„í•´ì„œ ë§ì´ ì¢‹ì•„ì¡Œì–´ìš”.', 
                tip: 'Means "compared to" or "in comparison with." Shows direct comparison.', 
                resourceUrl: 'https://www.howtostudykorean.com/unit-3-intermediate-korean-grammar/lessons-67-75/lesson-70/', 
                resourceTitle: 'Lesson 70: To compare: ë¹„êµí•˜ë‹¤, ë¹„í•˜ë‹¤', 
                resourceType: 'Interactive Article',
                resourceNote: 'Comprehensive comparison guide'
            },

            // Chapter 18: Time expressions
            { 
                chapter: 18, 
                title: 'ì‹œê°„ í‘œí˜„', 
                subtitle: 'Time expressions', 
                pattern: '-ë‹¤ê°€', 
                example: 'ê³µë¶€í•˜ë‹¤ê°€ ì ë“¤ì—ˆì–´ìš”.', 
                tip: 'Shows interruption or change during an action. Means "while doing" with interruption.', 
                videoUrl: 'https://www.youtube.com/watch?v=VXUCeUwVC2Q', 
                videoTitle: 'Live Korean Class | While (ë©´ì„œ, ë™ì•ˆ, ë‹¤ê°€)', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Interruption expressions compared'
            },
            { 
                chapter: 18, 
                title: 'ì‹œê°„ í‘œí˜„', 
                subtitle: 'Time expressions', 
                pattern: '-ë‹¤ê°€ëŠ”', 
                example: 'ì´ë ‡ê²Œ í•˜ë‹¤ê°€ëŠ” ì‹¤íŒ¨í•  ê±°ì˜ˆìš”.', 
                tip: 'Shows that continuing current action will lead to negative result.', 
                videoUrl: 'https://www.youtube.com/watch?v=NNlhAN1awWY', 
                videoTitle: 'ë‹¤ê°€ëŠ” Continuing Actions | Live Class Abridged', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Negative consequence expressions'
            },
            { 
                chapter: 18, 
                title: 'ì‹œê°„ í‘œí˜„', 
                subtitle: 'Time expressions', 
                pattern: '-ë‹¤ ë³´ë‹ˆê¹Œ', 
                example: 'ê³„ì† ê³µë¶€í•˜ë‹¤ ë³´ë‹ˆê¹Œ ì‹¤ë ¥ì´ ëŠ˜ì—ˆì–´ìš”.', 
                tip: 'Shows realization or result after doing something for a while.', 
                videoUrl: 'https://www.youtube.com/watch?v=EbFdl4hJoWg', 
                videoTitle: 'Live Korean Class | [Advanced] ~ë‹¤ ë³´ë‹ˆê¹Œ "Realizing"', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Realization through repetition'
            },
            { 
                chapter: 18, 
                title: 'ì‹œê°„ í‘œí˜„', 
                subtitle: 'Time expressions', 
                pattern: '-ë”ë‹ˆ', 
                example: 'ì•„í”„ë”ë‹ˆ ê²°êµ­ ë³‘ì›ì— ê°”ì–´ìš”.', 
                tip: 'Shows observation followed by result. Means "and then" with observation.', 
                videoUrl: 'https://www.youtube.com/watch?v=T68WpJPbO6c', 
                videoTitle: 'Learn Korean Ep. 72: ë”ë‹ˆ', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Observation-result connection'
            },
            { 
                chapter: 18, 
                title: 'ì‹œê°„ í‘œí˜„', 
                subtitle: 'Time expressions', 
                pattern: '-ëŠ” ëŒ€ë¡œ', 
                example: 'ë„ì°©í•˜ëŠ” ëŒ€ë¡œ ì—°ë½í•˜ì„¸ìš”.', 
                tip: 'Means "as soon as" or "immediately when." Shows immediate sequence.', 
                videoUrl: 'https://www.youtube.com/watch?v=rVaJDs_aaGQ', 
                videoTitle: 'Live Korean Class | [Intermediate] "As soon as" ëŒ€ë¡œ', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Immediate sequence expressions'
            },
            { 
                chapter: 18, 
                title: 'ì‹œê°„ í‘œí˜„', 
                subtitle: 'Time expressions', 
                pattern: '-ëŠ” ë§Œí¼', 
                example: 'ë…¸ë ¥í•˜ëŠ” ë§Œí¼ ê²°ê³¼ê°€ ë‚˜ì˜¬ ê±°ì˜ˆìš”.', 
                tip: 'Means "as much as" or "to the extent that." Shows proportional relationship.', 
                videoUrl: 'https://www.youtube.com/watch?v=ssblWhKO4gM', 
                videoTitle: 'Live Korean Class [Intermediate] ~ë§Œí¼ "As Much As" & "Because"', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Proportional relationships explained'
            },

            // Chapter 19: Cause expressions
            { 
                chapter: 19, 
                title: 'ì›ì¸ í‘œí˜„', 
                subtitle: 'Cause expressions', 
                pattern: '-ëŠ” ë°”ëŒì—', 
                example: 'ë¹„ê°€ ì˜¤ëŠ” ë°”ëŒì— ì†Œí’ì´ ì·¨ì†Œëì–´ìš”.', 
                tip: 'Shows unexpected negative result due to external cause. Often uncontrollable situations.', 
                videoUrl: 'https://www.youtube.com/watch?v=XTZSG4BqC1s', 
                videoTitle: 'Live Korean Class | [Intermediate] ~ëŠ” ë°”ëŒì— "Because of"', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Unexpected causes explained'
            },
            { 
                chapter: 19, 
                title: 'ì›ì¸ í‘œí˜„', 
                subtitle: 'Cause expressions', 
                pattern: '-ëŠ” íƒ“ì—', 
                example: 'êµí†µì²´ì¦ íƒ“ì— ëŠ¦ì—ˆì–´ìš”.', 
                tip: 'Shows cause with slight blame or responsibility. More formal than ë°”ëŒì—.', 
                videoUrl: 'https://www.youtube.com/watch?v=ZOShgYxqm5U', 
                videoTitle: 'Live Korean Class | "Because of" íƒ“ì—', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Blaming causes expressions'
            },
            { 
                chapter: 19, 
                title: 'ì›ì¸ í‘œí˜„', 
                subtitle: 'Cause expressions', 
                pattern: '-ëŠ” ê¹Œë‹­ì—', 
                example: 'ê·¸ëŸ° ê¹Œë‹­ì— ê²°ì •ì„ ë°”ê¿¨ì–´ìš”.', 
                tip: 'Formal way to express reason or cause. Often used in written Korean.', 
                resourceUrl: 'https://www.howtostudykorean.com/unit-6/lessons-142-150/lesson-147/', 
                resourceTitle: 'Lesson 147: ~ëŠ” ë°”ëŒì— â€“ A negative result occurred because of an action', 
                resourceType: 'Interactive Article',
                resourceNote: 'Formal cause expressions'
            },

            // Chapter 20: Degree expressions
            { 
                chapter: 20, 
                title: 'ì •ë„ í‘œí˜„', 
                subtitle: 'Degree expressions', 
                pattern: '-ëŠ” ì •ë„', 
                example: 'ìš¸ ì •ë„ë¡œ ê°ë™í–ˆì–´ìš”.', 
                tip: 'Shows degree or extent. Means "to the extent that" or "so much that."', 
                resourceUrl: 'https://www.koreantopik.com/2017/05/l2g42-av-grammar-to-extent-thatexpress.html', 
                resourceTitle: '(ìœ¼)ã„¹ ì •ë„ë¡œ and -(ìœ¼)ã„¹ ì •ë„ì´ë‹¤ grammar = to the extent that', 
                resourceType: 'Interactive Article',
                resourceNote: 'Degree expressions with quizzes'
            },
            { 
                chapter: 20, 
                title: 'ì •ë„ í‘œí˜„', 
                subtitle: 'Degree expressions', 
                pattern: '-ì•„/ì–´ì„œ', 
                example: 'ë„ˆë¬´ ì¶”ì›Œì„œ ë‚˜ê°ˆ ìˆ˜ ì—†ì–´ìš”.', 
                tip: 'Shows cause and effect. Basic way to express "so... that" or "because."', 
                videoUrl: 'https://www.youtube.com/watch?v=O1jhWMfJFdE', 
                videoTitle: 'How to Say "Because" Using Arthur/Eoseo - Korean Grammar', 
                channel: 'Learn Korean with KoreanClass101.com',
                resourceType: 'video',
                resourceNote: 'Basic cause-effect relationships'
            },
            { 
                chapter: 20, 
                title: 'ì •ë„ í‘œí˜„', 
                subtitle: 'Degree expressions', 
                pattern: '-(ìœ¼)ã„¹ ì •ë„ë¡œ', 
                example: 'ì£½ì„ ì •ë„ë¡œ ì•„íŒ ì–´ìš”.', 
                tip: 'Emphasizes extreme degree. Stronger than just -ëŠ” ì •ë„.', 
                resourceUrl: 'https://www.koreantopik.com/2017/05/l2g42-av-grammar-to-extent-thatexpress.html', 
                resourceTitle: '(ìœ¼)ã„¹ ì •ë„ë¡œ and -(ìœ¼)ã„¹ ì •ë„ì´ë‹¤ grammar = to the extent that', 
                resourceType: 'Interactive Article',
                resourceNote: 'Extreme degree expressions'
            },

            // Chapter 21: Situation expressions
            { 
                chapter: 21, 
                title: 'ìƒí™© í‘œí˜„', 
                subtitle: 'Situation expressions', 
                pattern: '-ëŠ” ì¤‘', 
                example: 'ì§€ê¸ˆ ê³µë¶€í•˜ëŠ” ì¤‘ì´ì—ìš”.', 
                tip: 'Shows ongoing action. Means "in the middle of" or "currently doing."', 
                videoUrl: 'https://www.youtube.com/watch?v=QBZFSeXZf_E', 
                videoTitle: 'In the middle (ä¸­) ì¤‘ & ì¤‘ì´ë‹¤ (í•œì) | Korean FAQ', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Ongoing actions explained'
            },
            { 
                chapter: 21, 
                title: 'ìƒí™© í‘œí˜„', 
                subtitle: 'Situation expressions', 
                pattern: '-ëŠ” ê°€ìš´ë°', 
                example: 'ë§ì€ ì‚¬ëŒë“¤ì´ ì§€ì¼œë³´ëŠ” ê°€ìš´ë° ì—°ì„¤í–ˆì–´ìš”.', 
                tip: 'Formal expression meaning "while" or "among." Often used in formal contexts.', 
                videoUrl: 'https://www.youtube.com/watch?v=orR7t8Orgm0', 
                videoTitle: 'Live Korean Class [Advanced] "While" ê°€ìš´ë°', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'Formal ongoing situations'
            },
            { 
                chapter: 21, 
                title: 'ìƒí™© í‘œí˜„', 
                subtitle: 'Situation expressions', 
                pattern: '-ëŠ” ë™ì•ˆ', 
                example: 'ë°©í•™ ë™ì•ˆ ì—¬í–‰ì„ ê°”ì–´ìš”.', 
                tip: 'Means "while" or "during." Shows time period when something happens.', 
                videoUrl: 'https://www.youtube.com/watch?v=IvRfhNO2vCk', 
                videoTitle: 'Korean Grammar - ëŠ” ë™ì•ˆì— during / while', 
                channel: 'Korean Grammar Channel',
                resourceType: 'video',
                resourceNote: 'Duration expressions'
            },
            { 
                chapter: 21, 
                title: 'ìƒí™© í‘œí˜„', 
                subtitle: 'Situation expressions', 
                pattern: '-ëŠ” ë„ì¤‘ì—', 
                example: 'íšŒì˜í•˜ëŠ” ë„ì¤‘ì— ì „í™”ê°€ ì™”ì–´ìš”.', 
                tip: 'Means "in the middle of" with emphasis on interruption or specific moment.', 
                videoUrl: 'https://www.youtube.com/watch?v=J-m5LHbHdAI', 
                videoTitle: '[ Intermediate Korean 40 ] â€“ëŠ” ë„ì¤‘ì— , â€“ëŠ” ê¸¸ì— , â€“ëŠ” ëŒ€ë¡œ', 
                channel: 'Tammy Korean',
                resourceType: 'video',
                resourceNote: 'Interruption expressions compared'
            },

            // Chapter 22: Other advanced expressions
            { 
                chapter: 22, 
                title: 'ê¸°íƒ€ ê³ ê¸‰ í‘œí˜„', 
                subtitle: 'Other advanced expressions', 
                pattern: '-ëŠ” ê¸¸ì—', 
                example: 'ì§‘ì— ê°€ëŠ” ê¸¸ì— ë§ˆíŠ¸ì— ë“¤ë €ì–´ìš”.', 
                tip: 'Means "on the way" to somewhere. Shows doing something while going somewhere.', 
                videoUrl: 'https://www.youtube.com/watch?v=Zrh-chSOD0M', 
                videoTitle: 'ê¸¸ì— "On the Way" | Live Class Abridged', 
                channel: 'Learn Korean with GO! Billy Korean',
                resourceType: 'video',
                resourceNote: 'On-the-way actions explained'
            },
            { 
                chapter: 22, 
                title: 'ê¸°íƒ€ ê³ ê¸‰ í‘œí˜„', 
                subtitle: 'Other advanced expressions', 
                pattern: '-ëŠ” ì°¸ì—', 
                example: 'ì²­ì†Œí•˜ëŠ” ì°¸ì— ì •ë¦¬ë„ í–ˆì–´ìš”.', 
                tip: 'Means "while at it" or "taking the opportunity." Similar to ê¹€ì— but more formal.', 
                resourceUrl: 'https://www.howtostudykorean.com/unit-7/lessons-151-158/lesson-156/', 
                resourceTitle: 'Lesson 156: ~(ìœ¼)ë ¤ëŠ” ì°¸ and ~(ìœ¼)ë ¤ë˜ ì°¸ â€“ One was just about to', 
                resourceType: 'Interactive Article',
                resourceNote: 'Opportunistic actions guide'
            },
            { 
                chapter: 22, 
                title: 'ê¸°íƒ€ ê³ ê¸‰ í‘œí˜„', 
                subtitle: 'Other advanced expressions', 
                pattern: '-ê³ ì„œ', 
                example: 'ìˆ™ì œë¥¼ í•˜ê³ ì„œ ë†€ì•˜ì–´ìš”.', 
                tip: 'Shows sequence - "after doing" something. Emphasizes completion before next action.', 
                resourceUrl: 'https://www.howtostudykorean.com/unit-3-intermediate-korean-grammar/lessons-67-75/lesson-72/', 
                resourceTitle: 'Lesson 72: ~ê³ ì„œì•¼, ~ê³  ë‚˜ì„œì•¼', 
                resourceType: 'Interactive Article',
                resourceNote: 'Sequence expressions with exercises'
            }
        ];
        */

        // Try to load base grammar content from external JSON to separate content from presentation
        async function loadBaseGrammar() {
            const candidates = ['content/grammar.json', 'grammar.json'];
            for (const path of candidates) {
                try {
                    const res = await fetch(path);
                    if (!res.ok) continue;
                    const data = await res.json();
                    if (Array.isArray(data)) {
                        grammarData = data;
                        return;
                    }
                    if (data && Array.isArray(data.items)) {
                        grammarData = data.items;
                        return;
                    }
                } catch (_) {
                    // Likely file:// or missing file; ignore and keep fallback
                }
            }
        }

        // Runtime enrichment disabled (build-time only)
        async function enrichFromChapterDetails() { return; }

        // Normalize all items to a consistent schema
        // - Ensure example (KO) and exampleEn (EN) fields exist
        // - Convert legacy video/resource fields into a unified resources[] array
        function normalizeItemSchema(item) {
            // If item already has resources in new format, preserve them
            if (Array.isArray(item.resources) && item.resources.length > 0) {
                // Just ensure required fields and return
                item.example = item.example || '';
                item.exampleEn = item.exampleEn || '';
                item.description = item.description || '';
                item.tip = item.tip || '';
                return item;
            }
            
            const resources = [];
            // Legacy: multiple videos array
            if (Array.isArray(item.videos)) {
                for (const v of item.videos) {
                    if (v?.url) {
                        resources.push({ type: 'video', url: v.url, title: v.title || '', channel: v.channel || '' });
                    }
                }
            }
            // Legacy: single video
            if (item.videoUrl) {
                resources.push({ type: 'video', url: item.videoUrl, title: item.videoTitle || '', channel: item.channel || '' });
            }
            // Legacy: single article/interactive resource
            if (item.resourceUrl) {
                const t = (item.resourceType || '').toLowerCase();
                const type = t.includes('video') ? 'video' : (t.includes('interactive') ? 'interactive' : 'article');
                resources.push({ type, url: item.resourceUrl, title: item.resourceTitle || '', channel: '' });
            }
            // Keep only valid video links (direct YouTube watch/short links) and all non-video links
            function isValidVideoUrl(url) {
                try {
                    const u = new URL(url);
                    if (u.hostname.includes('youtu.be')) return true;
                    if (u.hostname.includes('youtube.com') && u.searchParams.get('v')) return true;
                    return false;
                } catch (_) { return false; }
            }

            item.resources = resources.filter(r => r.type !== 'video' || isValidVideoUrl(r.url || ''));
            // Ensure fields
            item.example = item.example || '';
            item.exampleEn = item.exampleEn || '';
            item.description = item.description || '';
            item.tip = item.tip || '';
            // Fallback resources if none present
            if (!item.resources || item.resources.length === 0) {
                const qSite = encodeURIComponent((item.pattern || '').trim());
                item.resources = [
                    { type: 'article', url: `https://www.howtostudykorean.com/?s=${qSite}` , title: `HowToStudyKorean: ${item.pattern} ê²€ìƒ‰`, channel: '' }
                ];
            }
            return item;
        }

        function normalizeAll() {
            for (let i = 0; i < grammarData.length; i++) {
                grammarData[i] = normalizeItemSchema(grammarData[i]);
            }
        }

        // Simple video functionality (supports multiple videos per card)
        function getYoutubeEmbedUrl(url) {
            try {
                const u = new URL(url);
                if (u.hostname.includes('youtu.be')) {
                    return 'https://www.youtube.com/embed/' + u.pathname.replace('/', '');
                }
                const v = u.searchParams.get('v');
                if (v) return `https://www.youtube.com/embed/${v}`;
                return url;
            } catch (e) {
                return url;
            }
        }

        function isEmbeddableYoutube(url) {
            try {
                const u = new URL(url);
                if (u.hostname.includes('youtu.be')) return true;
                if (u.hostname.includes('youtube.com') && u.searchParams.get('v')) return true;
                return false;
            } catch (e) {
                return false;
            }
        }

        // Allow multiple videos to be open simultaneously
        function showVideo(index, subIndex) {
            const containerId = subIndex === undefined ? `video-${index}` : `video-${index}-${subIndex}`;
            const videoContainer = document.getElementById(containerId);
            if (!videoContainer) return;
            videoContainer.classList.add('show');
            const iframe = videoContainer.querySelector('iframe');
            if (!iframe) return;

            const item = grammarData[index];
            let url = '';
            if (Array.isArray(item.resources) && subIndex !== undefined) {
                url = item.resources[subIndex]?.url || '';
            } else if (item?.videoUrl) {
                url = item.videoUrl;
            }
            if (url) {
                iframe.src = getYoutubeEmbedUrl(url);
            }
        }

        function hideVideo(index, subIndex) {
            const containerId = subIndex === undefined ? `video-${index}` : `video-${index}-${subIndex}`;
            const videoContainer = document.getElementById(containerId);
            if (!videoContainer) return;
            videoContainer.classList.remove('show');
            const iframe = videoContainer.querySelector('iframe');
            if (iframe) iframe.src = '';
        }

        async function generateMoreExamples(globalIndex) {
            const item = grammarData[globalIndex];
            const container = document.getElementById(`examples-${globalIndex}`);
            if (!item || !container) return;
            container.innerHTML = '<div class="text-sm text-gray-500">Generating examples...</div>';

            try {
                const res = await fetch('http://localhost:8787/api/generate-examples', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        pattern: item.pattern,
                        description: item.description || '',
                        tip: item.tip || '',
                        existingExample: item.example || ''
                    })
                });
                if (!res.ok) throw new Error('API request failed');
                const data = await res.json();
                const examples = data.examples || [];
                container.innerHTML = examples.map(ex => `
                    <div class="bg-white/60 rounded-lg p-3 mb-2">
                        <div class="korean-text text-base mb-1">${ex.korean}</div>
                        <div class="text-sm text-gray-600 italic">${ex.english}</div>
                    </div>
                `).join('');
                // auto show if hidden
                document.getElementById(`examples-toggle-${globalIndex}`).textContent = 'Hide';
                container.classList.remove('hidden');
            } catch (e) {
                container.innerHTML = '<div class="text-sm text-red-600">Failed to generate examples.</div>';
            }
        }

        function toggleExamples(globalIndex) {
            const container = document.getElementById(`examples-${globalIndex}`);
            const btn = document.getElementById(`examples-toggle-${globalIndex}`);
            if (!container || !btn) return;
            const isHidden = container.classList.contains('hidden');
            if (isHidden) {
                container.classList.remove('hidden');
                btn.textContent = 'Hide';
                if (container.innerHTML.trim() === '') {
                    // lazily generate on first open
                    generateMoreExamples(globalIndex);
                }
            } else {
                container.classList.add('hidden');
                btn.textContent = 'Show';
            }
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            const chapterNav = document.getElementById('chapter-nav');
            const cardsContainer = document.getElementById('grammar-cards-container');
            const chapterTitleEl = document.getElementById('chapter-title');
            const chapterSubtitleEl = document.getElementById('chapter-subtitle');
            const searchInput = document.getElementById('search-input');

            let currentChapter = 1;
            
            const computeChapters = () =>
                [...new Map(grammarData.map(item => [item.chapter, item])).values()]
                    .sort((a, b) => (a.chapter || 0) - (b.chapter || 0));

            const createCard = (item, index) => {
                const globalIndex = grammarData.indexOf(item);
                const hasResources = Array.isArray(item.resources) && item.resources.length > 0;
                

                
                let resourceSection = '';
                if (hasResources) {
                    const blocks = item.resources.map((r, ridx) => {
                        if (r.type === 'video') {
                            const canEmbed = isEmbeddableYoutube(r.url || '');
                            if (canEmbed) {
                                return `
                                    <div class="mt-6 pt-4 border-t border-gray-200">
                                        <div class="flex justify-between items-center">
                                            <div class="flex-1">
                                                <h4 class="font-semibold text-gray-700 mb-1">ğŸ“¹ Video Lesson ${ridx + 1}</h4>
                                                <p class="text-sm text-gray-600">${r.channel || ''}</p>
                                            </div>
                                            <div class="space-x-2">
                                                <button onclick="showVideo(${globalIndex}, ${ridx})" class="video-button">â–¶ Video</button>
                                                <button onclick="hideVideo(${globalIndex}, ${ridx})" class="close-button">Close</button>
                                            </div>
                                        </div>
                                        <div id="video-${globalIndex}-${ridx}" class="video-container">
                                            <div class="aspect-w-16 aspect-h-9">
                                                <iframe width="100%" height="400" src="" frameborder="0" allowfullscreen class="rounded-lg"></iframe>
                                            </div>
                                            <div class="mt-3 text-sm text-gray-600">
                                                <strong>Video:</strong> ${r.title || ''}<br>
                                                <strong>Channel:</strong> ${r.channel || ''}
                                            </div>
                                        </div>
                                    </div>
                                `;
                            } else {
                                return `
                                    <div class="mt-6 pt-4 border-t border-gray-200">
                                        <div class="flex justify-between items-center">
                                            <div class="flex-1">
                                                <h4 class="font-semibold text-gray-700 mb-1">ğŸ“¹ Video Lesson ${ridx + 1}</h4>
                                                <p class="text-sm text-gray-600">${r.channel || ''}</p>
                                            </div>
                                            <div class="space-x-2">
                                                <a href="${r.url}" target="_blank" class="video-button">â–¶ Video</a>
                                                <button onclick="hideVideo(${globalIndex}, ${ridx})" class="close-button">Close</button>
                                            </div>
                                        </div>
                                        <div class="text-sm text-gray-600">
                                            <strong>Video:</strong> ${r.title || ''}<br>
                                            <strong>Channel:</strong> ${r.channel || ''}
                                        </div>
                                    </div>
                                `;
                            }
                        }
                        const label = r.type === 'interactive' ? 'Interactive' : 'Article';
                        return `
                            <div class="mt-6 pt-4 border-t border-gray-200">
                                <a href="${r.url}" target="_blank" class="inline-block px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition mb-2">
                                    ğŸ“š ${label}
                                </a>
                                <div class="text-sm text-gray-600">
                                    <strong>Resource:</strong> ${r.title || ''}
                                </div>
                            </div>
                        `;
                    }).join('');
                    resourceSection = blocks;
                }

                // Determine resource type badge from first resource (new schema)
                let resourceBadge = '';
                const primaryType = (Array.isArray(item.resources) && item.resources[0]?.type) ? item.resources[0].type : '';
                if (primaryType) {
                    const badgeClass = primaryType === 'video' ? 'video-res' : (primaryType === 'interactive' ? 'interactive-res' : 'article-res');
                    const label = primaryType.charAt(0).toUpperCase() + primaryType.slice(1);
                    resourceBadge = `<span class="resource-type ${badgeClass}">${label}</span>`;
                }

                return `
                    <div class="grammar-card p-6 md:p-8">
                        <div class="flex justify-between items-start">
                            <h3 class="pattern-title text-2xl md:text-3xl mb-4">${item.pattern}</h3>
                            <span class="chapter-badge">Ch. ${item.chapter}</span>
                        </div>
                        <p class="text-lg text-gray-600 mb-4">Korean Grammar Pattern</p>
                        
                        <div class="example-box">
                            <h4 class="font-semibold text-amber-800 mb-2">ğŸ“ Example</h4>
                            <div class="korean-text text-lg mb-2">${item.example}</div>
                            <div class="english-text">${item.exampleEn || item.example_en || 'Korean example with context and usage'}</div>
                        </div>

                        ${item.description ? `
                        <div class="tip-box">
                            <h4 class="font-semibold text-blue-800 mb-2">ğŸ“– Overview</h4>
                            <p class="text-gray-700">${item.description}</p>
                        </div>
                        ` : ''}

                        <div class="tip-box">
                            <h4 class="font-semibold text-blue-800 mb-2">ğŸ’¡ Usage Tip</h4>
                            <p class="text-gray-700">${item.tip}</p>
                        </div>

                        <div class="bg-gradient-to-r from-purple-50 to-pink-50 border-l-4 border-purple-500 p-4 rounded-lg my-4">
                            <div class="flex items-center justify-between">
                                <h4 class="font-semibold text-purple-800">ğŸ¯ More Examples</h4>
                                <div class="space-x-2">
                                    <button id="examples-toggle-${globalIndex}" class="video-button" onclick="toggleExamples(${globalIndex})">Show</button>
                                    <button class="video-button" onclick="generateMoreExamples(${globalIndex})">Generate more</button>
                                </div>
                            </div>
                            <div id="examples-${globalIndex}" class="mt-3 hidden"></div>
                        </div>

                        ${item.resourceNote ? `
                        <div class="resource-report">
                            <div class="flex items-center mb-2">
                                ${resourceBadge}
                                <span class="font-medium">Resource Details:</span>
                            </div>
                            <p class="text-gray-700">${item.resourceNote}</p>
                        </div>
                        ` : ''}

                        ${resourceSection}
                    </div>
                `;
            };

            const renderCards = (data) => {
                cardsContainer.innerHTML = data.length > 0 ? data.map((item, index) => createCard(item, index)).join('') : 
                    '<div class="text-center py-12"><p class="text-xl text-gray-500">ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>';
            };

            const renderNav = () => {
                const chapters = computeChapters();
                chapterNav.innerHTML = chapters.map(c => `
                    <a href="#" class="nav-link block px-4 py-3 text-sm text-gray-700 hover:bg-gray-100 rounded-lg transition" data-chapter="${c.chapter}">
                        <span class="font-semibold text-blue-600">${c.chapter}.</span> ${c.title}
                        <div class="text-xs text-gray-500 mt-1">${c.subtitle}</div>
                    </a>
                `).join('');
            };

            const showChapter = (chapterNum) => {
                const chapterData = grammarData.filter(item => item.chapter === chapterNum);
                if (chapterData.length > 0) {
                    chapterTitleEl.textContent = `${chapterNum}. ${chapterData[0].title}`;
                    chapterSubtitleEl.textContent = chapterData[0].subtitle;
                    renderCards(chapterData);
                    
                    // Update active nav link
                    document.querySelectorAll('.nav-link').forEach(link => {
                        link.classList.remove('active');
                    });
                    document.querySelector(`[data-chapter="${chapterNum}"]`).classList.add('active');
                    
                    currentChapter = chapterNum;
                }
            };

            // Event listeners
            chapterNav.addEventListener('click', (e) => {
                e.preventDefault();
                const link = e.target.closest('.nav-link');
                if (link) {
                    const chapterNum = parseInt(link.dataset.chapter);
                    showChapter(chapterNum);
                }
            });

            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                if (query.trim() === '') {
                    showChapter(currentChapter);
                } else {
                    const filtered = grammarData.filter(item => 
                        item.pattern.toLowerCase().includes(query) ||
                        item.example.toLowerCase().includes(query) ||
                        item.tip.toLowerCase().includes(query)
                    );
                    chapterTitleEl.textContent = 'ê²€ìƒ‰ ê²°ê³¼';
                    chapterSubtitleEl.textContent = `"${query}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼`;
                    renderCards(filtered);
                }
            });

            // Initialize (load content, enrich, then render)
            (async () => {
                await loadBaseGrammar();
                normalizeAll();
                renderNav();
                showChapter(1);
            })();
        });
    </script>
</body>
</html>
